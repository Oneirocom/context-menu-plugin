{"version":3,"file":"context-menu-plugin.min.js","sources":["../src/utils.js","../src/menu/debounceHide.js","../src/menu/index.js","../src/main-menu.js","../src/node-menu.js","../src/index.js"],"sourcesContent":["export function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\n\nexport async function createNode(component, { data = {}, meta = {}, x = 0, y = 0 }) {\n    const node = await component.createNode(deepCopy(data));\n\n    node.meta = Object.assign(deepCopy(meta), node.meta);\n    node.position[0] = x;\n    node.position[1] = y;\n    \n    return node;\n}\n\nexport function traverse(items, callback, path = []) {\n    if (typeof items !== 'object') return;\n\n    Object.keys(items).map(key => {\n        if (typeof items[key] === 'function')\n            callback(key, items[key], path)\n        else \n            traverse(items[key], callback, [...path, key])\n    })\n}\n\nexport function fitViewport([x, y], element) {\n    return [\n        Math.min(x, window.innerWidth - element.clientWidth),\n        Math.min(y, window.innerHeight - element.clientHeight)\n    ]\n}","import { debounce } from 'lodash-es';\n\nexport default (hideMethod) => ({\n    props: { delay: { type: Number, required: true } },\n    data() {\n        return {\n            timeoutHide: () => {}\n        }\n    },\n    methods: {\n        cancelHide() {\n            const hide = this.timeoutHide;\n    \n            if (hide && hide.cancel)\n                this.timeoutHide.cancel();\n        }\n    },\n    mounted() {\n        this.timeoutHide = debounce(this[hideMethod], this.delay);\n    }\n})","import Menu from './Menu.vue';\nimport Vue from 'vue';\n\nexport default class {\n    \n    constructor(editor, props, vueComponent) {\n        const el = document.createElement('div');\n\n        editor.view.container.appendChild(el);\n\n        this.menu = new Vue({\n            render: h => h(vueComponent || Menu, { props })\n        }).$mount(el);\n    }\n\n    addItem(...args) {\n        this.menu.$emit('additem', ...args);\n    }\n\n    show(...args) {\n        this.menu.$emit('show', ...args);\n    }\n\n    hide() {\n        this.menu.$emit('hide');\n    }\n}","import { createNode, traverse } from \"./utils\";\nimport Menu from \"./menu/index\";\n\nexport default class MainMenu extends Menu {\n  constructor(editor, props, vueComponent, { items, allocate, rename }) {\n    super(editor, props, vueComponent);\n\n    const initialPosition = {\n      x: editor.view.area.mouse.x,\n      y: editor.view.area.mouse.y,\n    };\n\n    console.log(\"INITIAL POSITION\", initialPosition);\n\n    for (const component of editor.components.values()) {\n      const path = allocate(component);\n\n      if (Array.isArray(path)) {\n        // add to the menu if path is array\n        this.addItem(\n          rename(component),\n          async () => {\n            editor.addNode(await createNode(component, initialPosition));\n          },\n          path\n        );\n      }\n    }\n\n    traverse(items, (name, func, path) => this.addItem(name, func, path));\n  }\n}\n","import Menu from './menu/index';\nimport { createNode, traverse } from './utils';\n\nexport default class NodeMenu extends Menu {\n    constructor(editor, props, vueComponent, nodeItems) {\n        super(editor, props, vueComponent);\n\n        if (nodeItems['Delete'] !== false) {\n            this.addItem('Delete', ({ node }) => {\n                if (editor.selected.list.indexOf(node) !== -1) {\n                    editor.selected.remove(node);\n                }\n\n                editor.removeNode(node);\n            });\n        }\n        if (nodeItems['Clone'] !== false) {\n            this.addItem('Clone', async (args) => {\n                const { name, position: [x, y], ...params } = args.node;\n                const component = editor.components.get(name);\n                const node = await createNode(component, { ...params, x: x + 10, y: y + 10 });\n\n                editor.addNode(node);\n            });\n        }\n\n        traverse(nodeItems, (name, func, path) => this.addItem(name, func, path))\n    }\n}\n","import MainMenu from \"./main-menu\";\nimport NodeMenu from \"./node-menu\";\nimport VueItem from \"./menu/Item.vue\";\nimport VueMenu from \"./menu/Menu.vue\";\nimport VueSearch from \"./menu/Search.vue\";\nimport { isFunction } from \"lodash-es\";\n\nconsole.log(\"LOADED CONTEXT MENU\");\n\nfunction install(\n  editor,\n  {\n    searchBar = true,\n    searchKeep = () => false,\n    delay = 1000,\n    items = {},\n    nodeItems = {},\n    allocate = () => [],\n    rename = (component) => component.name,\n    vueComponent = null,\n  }\n) {\n  editor.bind(\"hidecontextmenu\");\n  editor.bind(\"showcontextmenu\");\n\n  let menu = null;\n\n  editor.on(\"hidecontextmenu\", () => {\n    if (menu) menu.hide();\n  });\n\n  editor.on(\"click contextmenu\", () => {\n    editor.trigger(\"hidecontextmenu\");\n  });\n\n  editor.on(\"contextmenu\", ({ e, node }) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log(\"CONTEXT MENU\", e, node);\n\n    if (!editor.trigger(\"showcontextmenu\", { e, node })) return;\n\n    const [x, y] = [e.clientX, e.clientY];\n\n    if (node) {\n      menu = new NodeMenu(\n        editor,\n        { searchBar: false, delay },\n        vueComponent,\n        isFunction(nodeItems) ? nodeItems(node) : nodeItems\n      );\n      menu.show(x, y, { node });\n    } else {\n      menu = new MainMenu(\n        editor,\n        { searchBar, searchKeep, delay },\n        vueComponent,\n        { items, allocate, rename },\n        { x, y }\n      );\n      menu.show(x, y);\n    }\n  });\n}\n\nexport const Menu = VueMenu;\nexport const Item = VueItem;\nexport const Search = VueSearch;\n\nexport default {\n  name: \"context-menu\",\n  install,\n};\n"],"names":["deepCopy","obj","JSON","parse","stringify","createNode","component","data","meta","x","y","node","Object","assign","position","traverse","items","callback","path","_typeof","keys","map","key","hideMethod","props","delay","type","Number","required","timeoutHide","methods","cancelHide","hide","this","cancel","mounted","debounce","element","Math","min","window","innerWidth","clientWidth","innerHeight","clientHeight","editor","vueComponent","el","document","createElement","view","container","appendChild","menu","Vue","render","h","Menu","$mount","args","$emit","MainMenu","allocate","rename","initialPosition","area","mouse","console","log","components","values","Array","isArray","addItem","addNode","name","func","_this","NodeMenu","nodeItems","selected","list","indexOf","remove","removeNode","params","get","Item","VueItem","Search","VueSearch","install","searchBar","searchKeep","bind","on","trigger","e","preventDefault","stopPropagation","clientX","clientY","isFunction","show","VueMenu"],"mappings":";;;;;8qWAAO,SAASA,EAASC,UACdC,KAAKC,MAAMD,KAAKE,UAAUH,aAGfI,mFAAf,WAA0BC,2GAAaC,KAAAA,aAAO,SAAIC,KAAAA,aAAO,SAAIC,EAAAA,aAAI,QAAGC,EAAAA,aAAI,aACxDJ,EAAUD,WAAWL,EAASO,kBAA3CI,UAEDH,KAAOI,OAAOC,OAAOb,EAASQ,GAAOG,EAAKH,MAC/CG,EAAKG,SAAS,GAAKL,EACnBE,EAAKG,SAAS,GAAKJ,oBAEZC,mEAGJ,SAASI,EAASC,EAAOC,EAAzB,OAAmCC,+BAAnC,EAAA,EAA0C,GACxB,WAAjBC,EAAOH,IAEXJ,OAAOQ,KAAKJ,GAAOK,IAAI,SAAAC,GACO,mBAAfN,EAAMM,GACbL,EAASK,EAAKN,EAAMM,GAAMJ,GAE1BH,EAASC,EAAMM,GAAML,cAAcC,IAAMI,mECnBrCC,SAAgB,CAC5BC,MAAO,CAAEC,MAAO,CAAEC,KAAMC,OAAQC,UAAU,IAC1CrB,sBACW,CACHsB,YAAa,eAGrBC,QAAS,CACLC,0BACUC,EAAOC,KAAKJ,YAEdG,GAAQA,EAAKE,QACbD,KAAKJ,YAAYK,WAG7BC,wBACSN,YAAcO,WAASH,KAAKV,GAAaU,KAAKR,m9VDOvBY,EAAJ3B,sCAAI2B,kBAAP5B,gBAAGC,WACrB,CACH4B,KAAKC,IAAI9B,EAAG+B,OAAOC,WAAaJ,EAAQK,aACxCJ,KAAKC,IAAI7B,EAAG8B,OAAOG,YAAcN,EAAQO,gsOEvBjCC,EAAQrB,EAAOsB,iBACjBC,EAAKC,SAASC,cAAc,OAElCJ,EAAOK,KAAKC,UAAUC,YAAYL,QAE7BM,KAAO,IAAIC,EAAI,CAChBC,OAAQ,SAAAC,UAAKA,EAAEV,GAAgBW,EAAM,CAAEjC,MAAAA,OACxCkC,OAAOX,iDAGd,wCAAWY,2BAAAA,0BACFN,MAAKO,eAAM,kBAAcD,wBAGlC,wCAAQA,2BAAAA,0BACCN,MAAKO,eAAM,eAAWD,wBAG/B,gBACSN,KAAKO,MAAM,6CCrBHC,iBAAiBJ,yBACxBZ,EAAQrB,EAAOsB,SAAgB9B,IAAAA,MAAO8C,IAAAA,SAAUC,IAAAA,mCACpDlB,EAAQrB,EAAOsB,GAEfkB,EAAkB,CACtBvD,EAAGoC,EAAOK,KAAKe,KAAKC,MAAMzD,EAC1BC,EAAGmC,EAAOK,KAAKe,KAAKC,MAAMxD,GAG5ByD,QAAQC,IAAI,mBAAoBJ,aAERnB,EAAOwB,WAAWC,yDAA/BhE,UACHY,EAAO4C,EAASxD,GAElBiE,MAAMC,QAAQtD,MAEXuD,QACHV,EAAOzD,6BACP,wGACEuC,WAAqBxC,EAAWC,EAAW0D,2BAApCU,iEAETxD,2CAKNH,EAASC,EAAO,SAAC2D,EAAMC,EAAM1D,UAAS2D,EAAKJ,QAAQE,EAAMC,EAAM1D,yCC1B9C4D,iBAAiBrB,yBACtBZ,EAAQrB,EAAOsB,EAAciC,wCAC/BlC,EAAQrB,EAAOsB,IAEO,IAAxBiC,EAAS,UACJN,QAAQ,SAAU,YAAG9D,IAAAA,MACsB,IAAxCkC,EAAOmC,SAASC,KAAKC,QAAQvE,IAC7BkC,EAAOmC,SAASG,OAAOxE,GAG3BkC,EAAOuC,WAAWzE,MAGC,IAAvBoE,EAAS,SACJN,QAAQ,mDAAS,WAAOd,uGACqBA,EAAKhD,KAA3CgE,IAAAA,WAAM7D,YAAWL,OAAGC,OAAO2E,SAC7B/E,EAAYuC,EAAOwB,WAAWiB,IAAIX,YACrBtE,EAAWC,SAAgB+E,OAAQ5E,EAAGA,EAAI,GAAIC,EAAGA,EAAI,aAAlEC,SAENkC,EAAO6B,QAAQ/D,mGAIvBI,EAASgE,EAAW,SAACJ,EAAMC,EAAM1D,UAAS2D,EAAKJ,QAAQE,EAAMC,EAAM1D,mBCnB3EiD,QAAQC,IAAI,uBA4DCmB,EAAOC,EACPC,EAASC,IAEP,CACbf,KAAM,eACNgB,QA/DF,SACE9C,aAEE+C,UAAAA,gBACAC,gBAAAA,YAAa,kBAAM,KACnBpE,gBAAAA,OAAQ,MACRT,gBAAAA,OAAQ,KACR+D,gBAAAA,WAAY,KACZjB,gBAAAA,UAAW,iBAAM,MACjBC,gBAAAA,QAAS,SAACzD,UAAcA,EAAUqE,QAClC7B,gBAAAA,cAAe,OAGjBD,EAAOiD,KAAK,mBACZjD,EAAOiD,KAAK,uBAERzC,EAAO,KAEXR,EAAOkD,GAAG,kBAAmB,WACvB1C,GAAMA,EAAKrB,SAGjBa,EAAOkD,GAAG,oBAAqB,WAC7BlD,EAAOmD,QAAQ,qBAGjBnD,EAAOkD,GAAG,cAAe,gBAAGE,IAAAA,EAAGtF,IAAAA,KAC7BsF,EAAEC,iBACFD,EAAEE,kBAEFhC,QAAQC,IAAI,eAAgB6B,EAAGtF,GAE1BkC,EAAOmD,QAAQ,kBAAmB,CAAEC,EAAAA,EAAGtF,KAAAA,MAErCF,KAAQ,CAACwF,EAAEG,QAASH,EAAEI,aAAnB3F,OAENC,GACF0C,EAAO,IAAIyB,EACTjC,EACA,CAAE+C,WAAW,EAAOnE,MAAAA,GACpBqB,EACAwD,aAAWvB,GAAaA,EAAUpE,GAAQoE,IAEvCwB,KAAK9F,EAAGC,EAAG,CAAEC,KAAAA,KAElB0C,EAAO,IAAIQ,EACThB,EACA,CAAE+C,UAAAA,EAAWC,WAAAA,EAAYpE,MAAAA,GACzBqB,EACA,CAAE9B,MAAAA,EAAO8C,SAAAA,EAAUC,OAAAA,GACnB,CAAEtD,EAAAA,EAAGC,EAAAA,KAEF6F,KAAK9F,EAAGC,eAKC8F"}